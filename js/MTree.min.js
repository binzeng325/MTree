(function($){var settings={idField:"TerminalTag",foIdField:"OrgTag",text1Field:"PlateNo",text2Field:"TerminalID",iconField:"",icon:"icon-status-offline",checkbox:true,checked:true,singleSelect:true,showHide:true,expandFo:false,treeDataType:"fc",foData:[],foUrl:"",onFoClick:function(){},onFiClick:function(e,t){},onFiDblClick:function(e,t){},onFoCheck:function(e,t){},onFiCheck:function(e,t){},onFiContextMenu:function(e,t,a){},onFiMidClick:function(e,t,a){}};var theCommonValue={loadCount:0,theFoIdArrary:[],clickInterval:null,isChkFlag:false};var commonFun={checkCarCheckStatus:function(e){var t=$("#d"+e).parent();if(t!==undefined){var a=$(t).find(".carChecked").length;var o=$(t).find(".carNoChecked").length;if(a*o==0){if(a==0){$("#d"+e+" .orgChkboxShow").removeClass().addClass("orgChkboxShow orgNoCheck")}else{$("#d"+e+" .orgChkboxShow").removeClass().addClass("orgChkboxShow orgChecked")}}else{$("#d"+e+" .orgChkboxShow").removeClass().addClass("orgChkboxShow orgImChecked")}}},stringisInt:function(e){var t=/^[0-9]*$/;return t.test(e)},uncheckParent:function(e,t){var a=$("#d"+e+"Car").parent().parent();var o=$(a).attr("id");var n=o.substring(0,1)=="d"&&o.substring(o.length-3,o.length)=="Car";o=o.substring(1,o.length-3);if(n){var i=$("#d"+o).parent();var r=$(i).find(".carChecked").length;var s=$(i).find(".carNoChecked").length;if(r*s==0){if(r==0){$("#d"+o+" .orgChkboxShow").removeClass().addClass("orgChkboxShow orgNoCheck")}else{$("#d"+o+" .orgChkboxShow").removeClass().addClass("orgChkboxShow orgChecked")}}else{$("#d"+o+" .orgChkboxShow").removeClass().addClass("orgChkboxShow orgImChecked")}commonFun.uncheckParent(o,t)}},scrollerToView:function(e){var t=document.getElementById("carListContainer");var a=(e.offset().top-e.height()-30)*t.scrollHeight/carlistDom.height();if(e.offset().top>carlistDom.offset().top+100){t.scrollTop=t.scrollTop+a}},openFo:function(e){$("#"+e).show().addClass("orgNameSelect");$("#"+e+"Car").show();var t=$("#"+e).parent().parent();if(t!==undefined){var a=t[0].id;if(a!="theCarList")openParentOrg(a.substring(0,a.length-3))}},getNodeData:function(e,t){var a=$($(t).find(".terminalTag")).html();var o=$($(t).find(".orgtag")).html();var n=$($(t).find(".textField")).html();var i=$($(t).find(".hideField")).html();var r=$(e).hasClass("carChecked");return{id:a,foId:o,text:n,hideText:i,checked:r,dom:e}}};var bindEvent={bindFoEvent:function(){$(".orgName").unbind().live("click",function(){var e=this.id;$("#"+e+"Car").toggle();$(this).toggleClass("orgNameSelect")});$(".orgChkboxShow").unbind().live("click",function(e){e.stopPropagation();var t=this;var a=$(t).hasClass("orgChecked");var o=$(t).parent().parent();var n=$(o[0]).find(".orgChkboxShow");var i=$(o[0]).find(".carChkboxShow");if(a){$(t).removeClass().addClass("orgChkboxShow orgNoCheck")}else{$(t).removeClass().addClass("orgChkboxShow orgChecked")}$(n).each(function(){if(a){$(this).removeClass().addClass("orgChkboxShow orgNoCheck")}else{$(this).removeClass().addClass("orgChkboxShow orgChecked")}});var r=[];$(i).each(function(){if(a){$(this).removeClass("carChecked").addClass("carNoChecked")}else{$(this).removeClass("carNoChecked").addClass("carChecked")}var e=$(this).parent().parent();var t=$($(e).find(".terminalTag")).html();r.push(t)});var s=$($(t).parent()).attr("id");commonFun.uncheckParent(s.substring(1,s.length),a);settings.onFoCheck(a,r)})},bindFiEvent:function(){$(".carItem").unbind().live("click",function(e){e.stopPropagation();var t=$(this);var a=this.id.toString().split("_")[0];var o=$(t).find(".carChecked");o=o.length>0||!settings.checkbox?true:false;if(settings.singleSelect)$(".carItem").removeClass("carItemSelected");if($(t).hasClass("carItemSelected")){if(!settings.singleSelect)t.removeClass("carItemSelected")}else{t.addClass("carItemSelected")}settings.onFiClick(o,a)});$(".carItem").unbind().live("mousedown",function(e){e.stopPropagation();var t=$(this);var a=this.id.toString().split("_")[0];var o=$(t).find(".carChecked");o=o.length>0||!settings.checkbox?true:false;if(e.which==2){settings.onFiMidClick(e,o,a)}else if(e.which==3){settings.onFiContextMenu(e,o,a)}});$(".carItem").unbind().live("dblclick",function(){var e=$(this);var t=this.id.toString().split("_")[0];var a=$(e).find(".carChecked");a=a.length>0||!settings.checkbox?true:false;settings.onFiDblClick(a,t)});$(".carNoChecked,.carChecked").unbind().live("click",function(e){e.stopPropagation();theCommonValue.isChkFlag=true;var t=this;var a=$(t).parent().parent();var o=$($(a).find(".terminalTag")).html();var n=$($(a).find(".orgtag")).html();var i=$(t).hasClass("carChecked");var r=[];r.push(o);if(i){$(t).removeClass("carChecked").addClass("carNoChecked")}else{$(t).removeClass("carNoChecked").addClass("carChecked")}settings.onFiCheck(i,r);commonFun.checkCarCheckStatus(n);commonFun.uncheckParent(n,i)});$(".carNoChecked,.carChecked").unbind().live("dblclick",function(e){e.stopPropagation()})}};var methods={init:function(options){if(options){$.extend(settings,options)}if(settings.foUrl!=""){$.ajax({url:settings.foUrl,type:"get",dataType:"jsonp",data:{},success:function(data){alert(data);if(data!=""){var foData=eval("("+data+")");methods.loadFoData(foData,this)}}})}if(settings.foData.length>0){methods.loadFoData(settings.foData,this)}},loadFoData:function(e,t){var a="";var o=settings.checked?"orgChecked":"orgNoCheck";var n="";theCommonValue.theFoIdArrary.length=0;if(settings.treeDataType=="fc"){s(e)}else if(settings.treeDataType=="ip"){i(e)}function i(e){var t=e.concat();var o=[];for(var n=0;n<t.length;n++){for(var i=0;i<t.length;i++){var s=t[n];var d=t[i];if(s.pid==d.id)break;if(i==t.length-1){o.push(s)}}}$(o).each(function(){c(this);var t=this.id;r(e,t);a+="</div></div>"})}function r(e,t){for(var o=0;o<e.length;o++){if(e[o].pid==t){c(e[o]);r(e,e[o].id);e.splice(o,1);a+="</div></div>"}}}function s(e){$(e).each(function(){c(this);if(this.children.length>0){s(this.children)}a+="</div></div>"})}function c(e){theCommonValue.theFoIdArrary.push(e.id);theCommonValue.loadCount=theCommonValue.theFoIdArrary.length;a+='<div class="orgFrm"><div class="orgName" id="d'+e.id+'">';if(settings.checkbox)a+='<div class="orgChkboxShow '+o+'"></div>';a+=e.text+'</div><div class="carFrm" id="d'+e.id+'Car">'}var d=t!==undefined?t:this;d.html(a);if(settings.expandFo){var h=$(".orgName");$(h).each(function(){var e=this.id;$("#"+e+"Car").toggle();$(this).toggleClass("orgNameSelect")})}bindEvent.bindFoEvent()},loadFiData:function(e,t){var a="";var o=settings.checked?"carChecked":"carNoChecked";theCommonValue.loadCount--;$(t).each(function(){var e=Date.parse(new Date);var t=settings.iconField!=""?this[settings.iconField]:settings.icon;a+='<div class="carItem" id="'+this[settings.idField]+'_Car">'+'<div class="carItemFrm">'+'<div class="carIcon '+t+'"></div>'+'<div class="carContent">'+'<span class="hideDiv orgtag" >'+this[settings.foIdField]+'</span><span class="hideDiv terminalTag">'+this[settings.idField]+"</span>"+'<div class="carFont">';if(settings.checkbox)a+=' <div class="carChkboxShow '+o+'"></div>';a+='<span class="textField">'+this[settings.text1Field]+"</span>";if(settings.showHide)a+='<font style="color:#aaa">(<span class="hideField">'+this[settings.text2Field]+"</span>)</font>";a+="</div>"+"</div></div></div>"});$("#d"+e+"Car").append(a);if(theCommonValue.loadCount==0)bindEvent.bindFiEvent()},select:function(e){if(settings.singleSelect)$(".carItem").removeClass("carItemSelected");var t=$("#"+e+"_Car");t.addClass("carItemSelected");var a=$("#theCarList");var o=t.find(".orgtag").html();openParentOrg("d"+o);commonFun.scrollerToView(t)},unSelect:function(e){var t=$("#"+e+"_Car");t.removeClass("carItemSelected")},unSelectAll:function(){$(".carItem").removeClass("carItemSelected")},getSelectedFi:function(){var e=$(".carItemSelected");var t=[];$(e).each(function(){var e=this;var a=commonFun.getNodeData(e,e);t.push(a)});return t},getCheckedFi:function(){var e=$(".carChecked");var t=[];var a=[];$(e).each(function(){var e=this;var t=$(e).parent().parent();var o=commonFun.getNodeData(e,t);a.push(o)});return a},checkFi:function(e){var t=$("#"+e+"_Car .carChkboxShow");$(t).removeClass("carNoChecked").addClass("carChecked");var a=$("#"+e+"_Car .orgtag").html();commonFun.checkCarCheckStatus(a);commonFun.uncheckParent(a,true)},unCheckFi:function(e){var t=$("#"+e+"_Car .carChkboxShow");$(t).removeClass("carChecked").addClass("carNoChecked");var a=$("#"+e+"_Car .orgtag").html();commonFun.checkCarCheckStatus(a);commonFun.uncheckParent(a,false)},checkAll:function(){var e=$(".carChkboxShow");$(".orgChkboxShow").removeClass().addClass("orgChkboxShow orgChecked");$(e).each(function(){$(this).removeClass("carNoChecked").addClass("carChecked")})},uncheckAll:function(){var e=$(".carChkboxShow");$(".orgChkboxShow").removeClass().addClass("orgChkboxShow orgNoCheck");$(e).each(function(){$(this).removeClass("carChecked").addClass("carNoChecked")})},updateFi:function(e,t,a,o){if(t!==undefined){var n=$("#"+e+"_Car .carIcon");$(n).removeClass().addClass("carIcon "+t)}if(a!==undefined)$("#"+e+"_Car .textField").html(a);if(o!==undefined)$("#"+e+"_Car .hideField").html(o)},fuzzyQuery:function(e,t,a){var o=[];var n=[];$(".carItem").removeClass("match");if(a===undefined||a=="hideFi"){var i;i=a=="hideFi"?$(".hideField"):$(".textField");$(i).each(function(){if($(this).html().indexOf(e)!=-1){var t=$(this).parent().parent();if(a=="hideFi")t=$(t).parent();var o=$($(t).find(".terminalTag")).html();var i=commonFun.getNodeData(this,t);n.push(i);r(o)}})}else if(a=="id"){var i=$("#"+e+"_Car");n.push(commonFun.getNodeData(i))}function r(e){if(t!==undefined&&t)$("#"+e+"_Car").addClass("match")}return n},clearMath:function(){$(".carItem").removeClass("match")},getFoIds:function(){return theCommonValue.theFoIdArrary},clearFoIds:function(){theCommonValue.theFoIdArrary.length=0}};$.fn.mTree=function(e){if(methods[e]){return methods[e].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof(e==="object"||!e)){return methods.init.apply(this,arguments)}else{$.error("Method"+e+"does not exist")}}})(jQuery);